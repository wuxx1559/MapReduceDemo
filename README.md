# MapReduce_Demo

```java
@author = Renjie Li, Di Wu
```

## usage

1. compile and give the test file execute permission

```bash
make clean; make
chmod +x test.sh
```

2. put the dataset in data/ directory, and its structure should be like below (put all raw text files inside `input_dir`)

```txt
├── data
│   ├── input_dir
│   ├── positive.txt
│   └── negative.txt
```

3. change configuration files in `config` directory, each file (for Compute Nodes) should be (`server.cfg` does not have the last line). 

```txt
[IP Address]
[port number]
[Load Possibility]
```

If you want to add more Compute Nodes, just add more configuration files for them in the same format.

4. start Server and Compute Nodes by using command line (in five different machines or terminals).

If you try to run it on different machines, please use `ssh` command to log in remote machines first.

And make sure use the same directory for all Compute Nodes, Client and Server (for multiple machines please use NSF).

```bash
./test.sh Server
./test.sh CN1
./test.sh CN2
./test.sh CN3
./test.sh CN4
```

This script assume that we have 4 Compute Nodes. If you want to add more, you can use the command line below (it's an example of 5 Compute Nodes) to run Server (or you can change line 8 in `test.sh` directly):

```bash
java -cp ".:/usr/local/Thrift/*" Server config/server.cfg config/CN1.cfg config/CN2.cfg config/CN3.cfg config/CN4.cfg config/CN5.cfg
```

5. run the client

```bash
./test.sh Client
```

6. the result will be in `data/output.txt`

## structure

* `data/` (should be upload by user): the directory of input dataset
* `config/`
    * `server.cfg`: the configuration file of the server
    * `CN1.cfg`, `CN2.cfg`, `CN3.cfg`, `CN4.cfg`: configuration files of Compute Nodes
    * `mapreduce.thrift`: the thrift file used for generating interfaces
* `doc/`
    * `Design.md`: the design of each `.java` file
    * `Evaluation.md`: test cases
* `Makefile`, `test.sh`: can be helpful for testing/debugging
* `Client2Server.java`, `Server2CN.java`, `Result.java`: interfaces, generated by thrift
* source files:
    * `Client.java`
    * `Server.java`, `ServerHandler.java`
    * `CN.java`, `CNHandler.java`
* `.gitignore`: avoid to upload some files to git server in debugging process
* `README.md`: this file
